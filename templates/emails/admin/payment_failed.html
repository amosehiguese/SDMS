{% extends "emails/base/admin_base.html" %}

{% block email_title %}Payment Failed - {{ order_number|default:"Unknown Order" }}{% endblock %}

{% block alert_title %}üí≥ Payment Failed{% endblock %}

{% block main_content %}
<div class="priority-high">
    <h3 style="margin-bottom: 15px;">Payment failure requires attention</h3>
    <p>A payment has failed{% if order_number %} for order {{ order_number }}{% endif %}. The customer and order may need follow-up.</p>
</div>

<table class="data-table">
    <tr>
        <th>Payment Details</th>
        <th>Information</th>
    </tr>
    <tr>
        <td>Payment ID</td>
        <td><strong>{{ payment_id }}</strong></td>
    </tr>
    {% if order_number %}
    <tr>
        <td>Order Number</td>
        <td><strong>{{ order_number }}</strong></td>
    </tr>
    {% endif %}
    <tr>
        <td>Customer</td>
        <td>{{ customer_email }}</td>
    </tr>
    {% if payment_reference %}
    <tr>
        <td>Payment Reference</td>
        <td>{{ payment_reference }}</td>
    </tr>
    {% endif %}
    <tr>
        <td>Amount</td>
        <td><strong>‚Ç¶{{ amount|floatformat:0 }}</strong></td>
    </tr>
    {% if payment_method %}
    <tr>
        <td>Payment Method</td>
        <td>{{ payment_method|title }}</td>
    </tr>
    {% endif %}
    <tr>
        <td>Failed At</td>
        <td>{{ failed_at|date:"F d, Y at g:i A" }}</td>
    </tr>
</table>

{% if error_message %}
<h3 style="margin: 25px 0 15px 0;">Error Details:</h3>
<div class="priority-high">
    <p><strong>Error Message:</strong> {{ error_message }}</p>
    {% if error_code %}
    <p><strong>Error Code:</strong> {{ error_code }}</p>
    {% endif %}
</div>
{% endif %}

{% if order_items %}
<h3 style="margin: 25px 0 15px 0;">Order Items:</h3>
<table class="data-table">
    <thead>
        <tr>
            <th>Product</th>
            <th>Quantity</th>
            <th>Price</th>
        </tr>
    </thead>
    <tbody>
        {% for item in order_items %}
        <tr>
            <td>{{ item.product_title }}</td>
            <td>{{ item.quantity }}</td>
            <td>‚Ç¶{{ item.total_price|floatformat:0 }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<div class="priority-high">
    <p><strong>‚ö†Ô∏è Action Required:</strong> You may want to contact the customer to help resolve the payment issue or provide alternative payment options.</p>
</div>
{% endblock %}

{% block action_button %}
<div style="text-align: center;">
    {% if order_id %}
    <a href="{{ site_url }}/admin/orders/order/{{ order_id }}/change/" class="button">Review Order</a>
    {% else %}
    <a href="{{ site_url }}/admin/payments/payment/{{ payment_id }}/change/" class="button">Review Payment</a>
    {% endif %}
</div>
{% endblock %}